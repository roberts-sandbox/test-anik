<!DOCTYPE html>
<html>
	<head>
		<link type="text/css" rel="stylesheet" href="/css/base.css">
		<link type="text/css" rel="stylesheet" href="/css/site.css">
		<title>OO in Interview Stories - Refactoring Static Data</title>
	</head>
	<body>
		<div class="main yui3-g">
			<div class="content yui3-u-2-3">
				<h1 id='oo_in_interview_stories__refactoring_static_data'>OO in Interview Stories - Refactoring Static Data</h1>

<p class='subtitle'>During which, a recently-gradudated interview candidate and I talk about refactoring static data.</p>
<hr />
<p>(You can catch up from the last post where the candidate and I talked about <a href='/2011/12/06/ramble.html' title='simple class design'>simple class design</a>.)</p>

<p>&#8220;So, Interview Candidate, let&#8217;s look at the classes that we have.&#8221;</p>
<div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Vertebrate</span><span class='p'>(</span><span class='nb'>object</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>,</span> <span class='n'>sound</span><span class='p'>):</span>
    <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span> <span class='o'>=</span> <span class='n'>sound</span>

  <span class='k'>def</span> <span class='nf'>sound</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span>

  <span class='k'>def</span> <span class='nf'>vertebrate</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>True</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Invertebrate</span><span class='p'>(</span><span class='nb'>object</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>,</span> <span class='n'>sound</span><span class='p'>):</span>
    <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span> <span class='o'>=</span> <span class='n'>sound</span>

  <span class='k'>def</span> <span class='nf'>sound</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span>

  <span class='k'>def</span> <span class='nf'>vertebrate</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>False</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Cat</span><span class='p'>(</span><span class='n'>Vertebrate</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='nb'>super</span><span class='p'>(</span><span class='n'>Cat</span><span class='p'>,</span> <span class='bp'>self</span><span class='p'>)</span><span class='o'>.</span><span class='n'>__init__</span><span class='p'>(</span><span class='s'>&#39;meow&#39;</span><span class='p'>)</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Spider</span><span class='p'>(</span><span class='n'>Invertebrate</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='nb'>super</span><span class='p'>(</span><span class='n'>Spider</span><span class='p'>,</span> <span class='bp'>self</span><span class='p'>)</span><span class='o'>.</span><span class='n'>__init__</span><span class='p'>(</span><span class='s'>&#39;*silence*&#39;</span><span class='p'>)</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='n'>cat</span> <span class='o'>=</span> <span class='n'>Cat</span><span class='p'>()</span>
<span class='n'>spider</span> <span class='o'>=</span> <span class='n'>Spider</span><span class='p'>()</span>

<span class='n'>animals</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>cat</span><span class='p'>,</span> <span class='n'>spider</span><span class='p'>]</span>
<span class='k'>for</span> <span class='n'>animal</span> <span class='ow'>in</span> <span class='n'>animals</span><span class='p'>:</span>
  <span class='k'>print</span> <span class='n'>animal</span><span class='o'>.</span><span class='n'>sound</span><span class='p'>(),</span> <span class='n'>animal</span><span class='o'>.</span><span class='n'>vertebrate</span>

<span class='c'># prints: meow True</span>
<span class='c'># prints: *silence* False</span>
</code></pre>
</div>
<p>&#8220;We&#8217;ve ensured that the &#8216;cat&#8217; and &#8216;spider&#8217; classes protect the invariant data that each contains, namely, the sound each animal makes. Now, do you see any refactoring opportunities?&#8221;</p>

<p>&#8221;&#8230; what&#8217;s refactoring?&#8221;</p>

<p>&#8220;Oh, ok. You&#8217;ll hear a lot of people throw that word around in the software development space. Quite often, you&#8217;ll find that developers and especially management will use the word &#8216;refactoring&#8217; to mean changing the code. However, a really smart guy named Opdyke first used the word and I think his meaning has the most merit. Specifically, refactoring code means that you change the implementation of the code without altering the existing behavior. Remember, in object-oriented programming, behavior is king.&#8221;</p>

<p>&#8220;So, you want me to make this code better but without changing the way it works?&#8221;</p>

<p>&#8220;Precisely. And, usually, better means simpler.&#8221;</p>

<p>&#8220;Well, both the &#8216;vertebrate&#8217; and &#8216;invertebrate&#8217; classes do the same thing.&#8221;</p>

<p>&#8220;What do you mean?&#8221;</p>

<p>&#8220;They both take a sound value and return it. We can make it simpler by making a single class that handles that.&#8221; I nodded my assent and he went to work.</p>
<div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Animal</span><span class='p'>(</span><span class='nb'>object</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>,</span> <span class='n'>sound</span><span class='p'>):</span>
    <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span> <span class='o'>=</span> <span class='n'>sound</span>

  <span class='k'>def</span> <span class='nf'>sound</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Vertebrate</span><span class='p'>(</span><span class='n'>Animal</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>vertebrate</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>True</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Invertebrate</span><span class='p'>(</span><span class='n'>Animal</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>vertebrate</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>False</span>
</code></pre>
</div>
<p>&#8220;I agree. That makes it simpler. Now, do you see anything else that we can simplify?&#8221;</p>

<p>He looked studiously at the board, concentration causing a slight tightening around his eyes. I directed my gaze out the window and thought some more about that falafel I had for lunch. It tasted better than normal, that day, but the hummus didn&#8217;t have enough tahini&#8230;.</p>

<p>&#8220;No, I don&#8217;t see anything.&#8221;</p>

<p>&#8220;No problem. Would you agree that less code would mostly result in simpler code?&#8221;</p>

<p>&#8220;Yeah.&#8221;</p>

<p>&#8220;Ok, then I&#8217;d like to examine the way that we handle the sound in the &#8216;animal&#8217; class. We&#8217;re working in Python, so we get a lot of expressive power that we won&#8217;t get in languages that have attributes resolved at compile time. Where does the &#8216;cat&#8217; class keep its &#8216;meow&#8217; sound?&#8221;</p>

<p>&#8220;In its initializer.&#8221;</p>

<p>&#8220;Right. Does it have to keep it there? Where else could it keep that piece of data?&#8221;</p>

<p>&#8220;In a field?&#8221;</p>

<p>&#8220;Right. Do that for me.&#8221;</p>
<div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Cat</span><span class='p'>(</span><span class='n'>Vertebrate</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span> <span class='o'>=</span> <span class='s'>&#39;meow&#39;</span>
    <span class='nb'>super</span><span class='p'>(</span><span class='n'>Cat</span><span class='p'>,</span> <span class='bp'>self</span><span class='p'>)</span><span class='o'>.</span><span class='n'>__init__</span><span class='p'>(</span><span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span><span class='p'>)</span>
</code></pre>
</div>
<p>&#8220;Nicely done, Interview Candidate. Now that you have set it in that variable, how can we change the &#8216;animal&#8217; class&#8217; implementation to take advantage of it?&#8221;</p>
<div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Animal</span><span class='p'>(</span><span class='nb'>object</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>sound</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>self</span><span class='o'>.</span><span class='n'>_sound</span>
</code></pre>
</div>
<p>&#8220;Like that?&#8221;</p>

<p>&#8220;Exactly. Now, I think we can simplify this a little more. What sound does a gray cat make?&#8221;</p>

<p>He looked at me oddly and replied, &#8220;Meow.&#8221;</p>

<p>&#8220;Right. Now, what sound does a torty make?&#8221;</p>

<p>&#8220;A what?!&#8221;</p>

<p>&#8220;Sorry, cat lover. What sound does an orange cat make?&#8221;</p>

<p>&#8220;Meow.&#8221;</p>

<p>&#8220;So, what sound does every cat in the world make that doesn&#8217;t suffer from laryngitis?&#8221;</p>

<p>&#8220;Meow.&#8221;</p>

<p>&#8220;Right again. Can you infer something from this small exercise of the Socratic method?&#8221;</p>

<p>Pause. &#8220;No.&#8221;</p>

<p>&#8220;No problem. In what kind of variable have you stored &#8216;meow?&#8217;&#8221;</p>

<p>&#8220;Um, a normal variable?&#8221;</p>

<p>&#8220;Yes, that&#8217;s true. Nothing special about it. However, you have stored it in an instance varaible. Which means that each instance of every cat in our system has its own special copy of it. Does that seem like a waste?&#8221;</p>

<p>&#8220;Yes, it does.&#8221;</p>

<p>&#8220;If we&#8217;ve encountered a waste, then that usually means we can write better code. Let me show you.&#8221;</p>
<div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Cat</span><span class='p'>(</span><span class='n'>Vertebrate</span><span class='p'>):</span>
  <span class='n'>SOUND</span> <span class='o'>=</span> <span class='s'>&#39;meow&#39;</span>
</code></pre>
</div>
<p>&#8220;Now, this implies to the reader of the class definition that the fact that a cat makes a &#8216;meow&#8217; sound belongs to <em>all</em> cats and not just each one individually. We can change the &#8216;animal&#8217; class to take advantage of this and the &#8216;spider&#8217; class to meet the expectations of the &#8216;animal&#8217; class.&#8221;</p>
<div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Animal</span><span class='p'>(</span><span class='nb'>object</span><span class='p'>):</span>
  <span class='k'>def</span> <span class='nf'>sound</span><span class='p'>(</span><span class='bp'>self</span><span class='p'>):</span>
    <span class='k'>return</span> <span class='bp'>self</span><span class='o'>.</span><span class='n'>SOUND</span>
</code></pre>
</div><div class='highlight'><pre><code class='python'><span class='k'>class</span> <span class='nc'>Spider</span><span class='p'>(</span><span class='n'>Invertebrate</span><span class='p'>):</span>
  <span class='n'>SOUND</span> <span class='o'>=</span> <span class='s'>&#39;*silence*&#39;</span>
</code></pre>
</div>
<p>&#8220;Not only have we simplified the code by removing lines that didn&#8217;t add value to the behavior, we&#8217;ve also created an implication in the use of the &#8216;animal&#8217; class. Can you spot it?&#8221;</p>

<p>&#8220;Yeah. You can&#8217;t get the animal&#8217;s sound without having some class that provides that capital &#8216;SOUND&#8217; variable.&#8221;</p>

<p>&#8220;Right-o. Now, when Jerry breaks the system by writing bad code, we can spot it more easily because he has not met the expectation of &#8216;animal.&#8217; We have allowed behavior to govern the system. Nice work, Interview Candidate.&#8221;</p>
			</div>
		<div>
	</body>
</html>